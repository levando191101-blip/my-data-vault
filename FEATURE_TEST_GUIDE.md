# 🧪 功能测试指南

## 📋 部署状态检查

### 1. Vercel 自动部署
- ✅ 代码已推送到 GitHub
- ⏳ Vercel 正在自动部署新版本
- 🔗 部署完成后访问：https://my-data-vault-iota.vercel.app/

### 2. 数据库迁移 ⚠️
在测试新功能前，**必须先应用数据库迁移**！

👉 **请按照 `DATABASE_MIGRATIONS.md` 中的说明操作**

---

## 🎯 新功能测试清单

### ✅ 1. 批量操作系统

**测试路径：** 搜索页面 (`/search`)

**测试步骤：**
1. 搜索一些文件
2. 悬停在文件卡片上，会显示复选框
3. 选中多个文件
4. 顶部会出现批量操作工具栏
5. 测试以下操作：
   - ✅ 全选 / 取消全选
   - ✅ 批量添加/移除/替换标签
   - ✅ 批量移动到分类
   - ✅ 批量下载
   - ✅ 批量删除（移至回收站）

**预期结果：**
- 批量操作工具栏显示选中数量
- 所有操作都有确认对话框
- 操作成功后显示 toast 通知

---

### ✅ 2. 高级搜索功能

**测试路径：** 搜索页面 (`/search`)

**测试步骤：**
1. 点击搜索框右侧的 **筛选图标** 🔍
2. 打开高级搜索对话框
3. 测试以下筛选条件：
   - ✅ 文件大小范围（最小/最大 MB）
   - ✅ 上传时间范围（开始/结束日期）
   - ✅ 文件类型（PDF、图片、视频等）
   - ✅ 分类筛选
   - ✅ 标签筛选
4. 点击 **应用筛选**
5. 检查搜索历史功能：
   - 在搜索框点击 **时钟图标** 🕒
   - 查看历史搜索记录
   - 点击历史记录快速搜索

**预期结果：**
- 筛选条件正确应用
- 结果数量准确
- 搜索历史自动保存（最多10条）
- 可以清空历史

---

### ✅ 3. 回收站功能

**测试路径：** 回收站页面 (`/trash`)

**前置条件：** 必须先应用数据库迁移！

**测试步骤：**
1. 在任意页面删除一些文件
2. 进入 **回收站** 页面（侧边栏）
3. 测试以下功能：
   - ✅ 查看已删除文件（带删除时间）
   - ✅ 恢复单个文件
   - ✅ 永久删除单个文件
   - ✅ 批量选择文件
   - ✅ 批量恢复
   - ✅ 批量永久删除
   - ✅ 清空回收站
4. 恢复文件后，检查文件是否回到原位置

**预期结果：**
- 删除的文件显示在回收站
- 恢复后文件回到原列表
- 永久删除会有警告提示
- 文件会显示"XX前删除"的时间标签

---

### ✅ 4. 文件预览增强

**测试路径：** 任意文件列表（我的资料、搜索结果）

**测试步骤：**
1. 点击不同类型的文件预览：
   - ✅ **图片文件** - 应该显示图片
   - ✅ **PDF 文件** - 应该显示 PDF 阅读器
   - ✅ **视频文件** (.mp4, .webm) - 应该显示视频播放器
   - ✅ **音频文件** (.mp3, .wav) - 应该显示音频播放器
   - ✅ **Markdown 文件** (.md) - 应该渲染 Markdown 内容
   - ✅ **代码文件** (.js, .py, .json 等) - 应该显示语法高亮
2. 测试播放控制（视频/音频）
3. 测试下载按钮

**预期结果：**
- 所有支持的文件类型都能正确预览
- 视频/音频可以播放、暂停、调节音量
- Markdown 正确渲染（标题、列表、代码块等）
- 代码文件有语法高亮

**注意：** 如果某些文件预览失败，可能是：
- 文件格式不支持
- Supabase 存储 URL 过期（需要刷新）

---

### ✅ 5. 数据导出功能

**测试路径：** 设置页面 (`/settings`)

**测试步骤：**
1. 滚动到 **数据导出** 部分
2. 测试以下导出：
   - ✅ 导出为 CSV（Excel 可打开）
   - ✅ 导出为 JSON（文本编辑器可查看）
   - ✅ 下载所有文件（逐个下载）
3. 检查导出文件内容是否正确

**预期结果：**
- CSV 文件包含所有资料元数据
- JSON 文件格式正确
- 批量下载会依次下载所有文件
- 有进度提示和完成通知

---

### ✅ 6. 快捷键支持

**测试路径：** 任意页面

**测试步骤：**
测试以下快捷键（Windows: Ctrl，Mac: Cmd）：

| 快捷键 | 功能 | 预期行为 |
|--------|------|----------|
| `Ctrl + K` | 打开搜索 | 跳转到搜索页面 |
| `Ctrl + U` | 打开上传 | 跳转到上传页面 |
| `Ctrl + H` | 返回首页 | 跳转到首页 |
| `Ctrl + M` | 我的资料 | 跳转到资料页面 |
| `Ctrl + T` | 回收站 | 跳转到回收站 |
| `Ctrl + ,` | 设置 | 跳转到设置页面 |
| `Esc` | 关闭对话框 | 关闭当前打开的对话框 |

**注意：**
- 在输入框中快捷键不会触发
- Mac 用户使用 `Cmd` 键代替 `Ctrl`

**预期结果：**
- 所有快捷键正确响应
- 页面快速切换无延迟

---

## 🐛 常见问题排查

### 问题 1：回收站功能不可用
**原因：** 未应用数据库迁移  
**解决：** 按照 `DATABASE_MIGRATIONS.md` 应用迁移

### 问题 2：文件预览失败
**原因：** Supabase URL 过期  
**解决：** 刷新页面，URL 会重新生成

### 问题 3：视频/音频播放失败
**原因：** 浏览器不支持该格式  
**解决：** 尝试其他浏览器或转换文件格式

### 问题 4：批量下载卡住
**原因：** 浏览器阻止多个下载  
**解决：** 允许浏览器弹出窗口和下载

### 问题 5：快捷键不响应
**原因：** 焦点在输入框内  
**解决：** 点击页面其他区域后再试

---

## 📊 性能测试建议

1. **批量操作性能：** 测试选择 100+ 文件的性能
2. **搜索性能：** 测试大量文件（1000+）的搜索速度
3. **预览加载速度：** 测试大文件（100MB+）的预览
4. **导出性能：** 测试导出大量数据的耗时

---

## ✅ 测试完成检查表

完成测试后，请确认：

- [ ] 所有 8 项新功能都已测试
- [ ] 没有发现严重 bug
- [ ] 数据库迁移已成功应用
- [ ] 所有快捷键正常工作
- [ ] 批量操作功能完整
- [ ] 文件预览支持多种格式
- [ ] 回收站功能正常
- [ ] 数据导出成功
- [ ] 用户体验流畅

---

## 📞 反馈

如有问题或建议，请：
1. 在 GitHub 提 Issue
2. 查看控制台错误日志
3. 检查网络请求状态

---

**测试愉快！** 🎉

如果一切正常，请享受这些强大的新功能！

